{% extends 'almacen/base.html' %}
{% load static %}

{% block content %}
<script src="{% static 'assets/js/jquery.min.js' %}"></script>
<script src="{% static 'assets/js/datatable/datatables/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'assets/js/datatable/datatables/datatable.custom.js' %}"></script>

<div class="page-body">
  <div class="container-fluid">
    <div class="page-title">
      <div class="row">
        <div class="col-6">
            {% if form1h_instance.serie %}
            <h4 class="card-title mb-0">
              Agregar Detalle de Formulario 1H - Serie {{ form1h_instance.serie.serie }} {{ form1h_instance.numero_serie }}
            </h4>
          {% else %}
            <h4 class="card-title mb-0">Agregar Detalle de Formulario 1H - Serie no disponible</h4>
          {% endif %}
          
          
          
        </div>
        <div class="col-6">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="">
                <svg class="stroke-icon">
                  <use href="{% static 'assets/svg/icon-sprite.svg#stroke-home' %}"></use>
                </svg></a></li>
            <li class="breadcrumb-item">Dashboard</li>
            <li class="breadcrumb-item active">Detalles de Factura</li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <div class="container-fluid">
    <div class="edit-profile">
      <div class="row">
        <div class="col-xl-12">
          <div class="card">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0">Nuevo Detalle de Factura</h5>
            </div>
            <div class="card-body">
              <form method="post">
                {% csrf_token %}
                <input type="hidden" name="form1h" value="{{ form1h_instance.id }}">
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="id_articulo" class="form-label">Artículo</label>
                    {{ form.articulo }}
                  </div>
                  <div class="col-md-6 mb-3">
                    <label for="id_cantidad" class="form-label">Cantidad</label>
                    {{ form.cantidad }}
                  </div>
                  <div class="col-md-6 mb-3">
                    <label for="id_precio_unitario" class="form-label">Precio Unitario</label>
                    {{ form.precio_unitario }}
                  </div>
                 
                  <div class="col-md-6 mb-3">
                    <label for="id_renglon" class="form-label">Renglón</label>
                    {{ form.renglon }}
                  </div>
                </div>
                <div class="text-end">
                  <button type="submit" class="btn btn-primary">Guardar Detalle</button>
                </div>
              </form>
            </div>
          </div>

          <!-- Sección para mostrar los detalles de la factura con el nuevo estilo de tabla -->
          <div class="col-sm-12">
            <div class="card">
              <div class="card-header">
                <h4>Detalles de la Factura</h4><span>Detalles de los artículos y su información correspondiente</span>
              </div>
              <div class="card-block row">
                <div class="col-sm-12 col-lg-12 col-xl-12">
                  <div class="table-responsive">
                    <table class="table light-card">
                      <thead>
                        <tr>
                          <th scope="col">ID Línea</th>
                          <th scope="col">Artículo</th>
                          <th scope="col">Cantidad</th>
                          <th scope="col">Precio Unitario</th>
                          <th scope="col">Precio Total</th>
                          <th scope="col">Renglón</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for detalle in detalles_factura %}
                          <tr>
                            <th scope="row">{{ detalle.id_linea }}</th>
                            <td>{{ detalle.articulo.nombre }}</td>
                            <td>{{ detalle.cantidad }}</td>
                            <td>Q{{ detalle.precio_unitario }}</td>
                            <td>Q{{ detalle.precio_total }}</td>
                            <td>{{ detalle.renglon }}</td>
                          </tr>
                        {% empty %}
                          <tr>
                            <td colspan="6" class="text-center">No hay detalles agregados aún.</td>
                          </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<script>
  $(document).ready(function () {
    $('.table').DataTable();
  });
</script>

{% endblock %}
