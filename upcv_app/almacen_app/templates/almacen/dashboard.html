{% extends 'almacen/base.html' %}
{% load static %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="page-body">
  <div class="container-fluid">
    <div class="page-title">
      <div class="row">
        <div class="col-6">
          <h2>Dashboard</h2>
        </div>
        <div class="col-6">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a href="#">
                <svg class="stroke-icon">
                  <use href="../assets/svg/icon-sprite.svg#stroke-home"></use>
                </svg>
              </a>
            </li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <!-- Gráficas con ApexCharts -->
  <div class="row" style="margin: 20px;">
    
    <!-- Card para el gráfico de Requerimientos por Tipo -->
    <div class="col-xl-6 col-md-12 box-col-12">
      <div class="card o-hidden">
        <div class="chart-widget-top">
          <div class="row card-body pb-0 m-0">
            <div class="col-xl-9 col-lg-8 col-9 p-0">
              <h6 class="mb-2">Requerimientos por Tipo</h6>
            </div>
          </div>
          <div id="reqChart"></div>
        </div>
      </div>
    </div>

    <!-- Card para el gráfico de Artículos por Vencer -->
<div class="col-xl-6 col-md-12 box-col-12">
  <div class="card o-hidden">
    <div class="chart-widget-top">
      <div class="row card-body pb-0 m-0">
        <div class="col-xl-12 col-lg-8 col-9 p-6">
<div class="d-flex align-items-center justify-content-between mb-6">
  <h6 class="mb-0">Artículos por Vencer (Próximos 30 días)</h6>
  <a href="{% url 'almacen:articulos_por_vencer' %}" class="btn btn-primary btn-sm">
    Ver artículos por vencer
  </a>
</div>

          <p>Total: {{ total_por_vencer }}</p>
        </div>
      </div>
      <div id="vencimientoChart"></div>
    </div>
  </div>
</div>

    <!-- Card para el gráfico de Totales de Artículos -->
    <div class="col-xl-6 col-md-12 box-col-12">
      <div class="card o-hidden">
        <div class="chart-widget-top">
          <div class="row card-body pb-0 m-0">
            <div class="col-xl-9 col-lg-8 col-9 p-0">
              <h6 class="mb-2">Totales de Artículos</h6>
            </div>
          </div>
          <div id="totalsChart"></div>
        </div>
      </div>
    </div>

    <!-- Card para el gráfico de Requerimientos Semanales -->
    <div class="col-xl-6 col-md-12 box-col-12">
      <div class="card o-hidden">
        <div class="chart-widget-top">
          <div class="row card-body pb-0 m-0">
            <div class="col-xl-9 col-lg-8 col-9 p-0">
              <h6 class="mb-2">Requerimientos Semanales</h6>
            </div>
          </div>
          <div id="semanalChart"></div>
        </div>
      </div>
    </div>
  </div>


  <!-- Scripts de ApexCharts -->
  <script src="{% static 'assets/js/chart/apex-chart/apex-chart.js' %}"></script>
  <script src="{% static 'assets/js/chart/apex-chart/chart-custom.js' %}"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Requerimientos por Tipo - Pie Chart
      const labelsReq = {{ labels_req|safe }};
      const dataReq = {{ data_req|safe }};

      var optionsReq = {
        chart: {
          type: 'pie',
          height: 350,
          toolbar: { show: false }
        },
        series: dataReq,
        labels: labelsReq,
        colors: ['#0c4a6e', '#4cb8a4', '#1e7d94', '#f9e5b4'],
        legend: { position: 'bottom' },
        responsive: [{
          breakpoint: 480,
          options: {
            chart: { width: 300 },
            legend: { position: 'bottom' }
          }
        }]
      };

      var reqChart = new ApexCharts(document.querySelector("#reqChart"), optionsReq);
      reqChart.render();

      // Totales de Artículos - Bar Chart
      var optionsTotals = {
        chart: {
          type: 'bar',
          height: 350,
          toolbar: { show: false }
        },
        series: [{
          name: 'Cantidad',
          data: [
            {{ totales_articulos.activos|default:0 }},
            {{ totales_articulos.inactivos|default:0 }},
            {{ ingresos|default:0 }},
            {{ salidas|default:0 }}
          ]
        }],
        xaxis: {
          categories: ['Activos', 'Inactivos', 'Entradas', 'Salidas']
        },
        plotOptions: {
          bar: {
            horizontal: false,
            columnWidth: '55%',
            endingShape: 'rounded'
          }
        },
        colors: ['#0c4a6e', '#4cb8a4', '#1e7d94', '#f9e5b4'],
        dataLabels: { enabled: false },
        tooltip: {
          y: { formatter: val => val }
        },
        yaxis: { min: 0 }
      };

      var totalsChart = new ApexCharts(document.querySelector("#totalsChart"), optionsTotals);
      totalsChart.render();

      // Requerimientos Semanales - Line Chart
      const semanas = {{ semanas|safe }};
      const cantidad_sem = {{ cantidad_sem|safe }};

      var optionsSemanal = {
        chart: {
          type: 'line',
          height: 350,
          toolbar: { show: false }
        },
        series: [{
          name: 'Req por semana',
          data: cantidad_sem
        }],
        xaxis: {
          categories: semanas
        },
        stroke: {
          curve: 'smooth'
        },
        fill: {
          type: 'gradient',
          gradient: { shadeIntensity: 1, opacityFrom: 0.7, opacityTo: 0.3, stops: [0, 90, 100] }
        },
         colors: ['#0c4a6e', '#4cb8a4', '#1e7d94', '#f9e5b4'],
        dataLabels: { enabled: false },
        tooltip: {
          y: { formatter: val => val }
        },
        yaxis: { min: 0 }
      };

      var semanalChart = new ApexCharts(document.querySelector("#semanalChart"), optionsSemanal);
      semanalChart.render();
    });

    // Artículos por Vencer - Bar Chart
const fechasVenc = {{ fechas_vencimiento|safe }};
const cantidadesVenc = {{ cantidades_vencimiento|safe }};

var optionsVencimiento = {
  chart: {
    type: 'bar',
    height: 350,
    toolbar: { show: false }
  },
  series: [{
    name: 'Cantidad',
    data: cantidadesVenc
  }],
  xaxis: {
    categories: fechasVenc,
    title: { text: '' }
  },
  plotOptions: {
    bar: {
      horizontal: false,
      columnWidth: '60%',
      endingShape: 'rounded'
    }
  },
   colors: ['#0c4a6e', '#4cb8a4', '#1e7d94', '#f9e5b4'],
  dataLabels: { enabled: false },
  tooltip: {
    y: { formatter: val => val }
  },
  yaxis: { min: 0 }
};

var vencimientoChart = new ApexCharts(document.querySelector("#vencimientoChart"), optionsVencimiento);
vencimientoChart.render();

  </script>

  <!-- Otros scripts de la plantilla -->
  <script src="{% static 'assets/js/jquery.min.js' %}"></script>
  <script src="{% static 'assets/js/bootstrap/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'assets/js/icons/feather-icon/feather.min.js' %}"></script>


  
  
{% endblock %}
